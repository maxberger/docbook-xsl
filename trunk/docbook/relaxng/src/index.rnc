# This file is part of DocBook NG: The "Absinthe" Release.

# This schema is a "work-in-progress". It validates a DocBook-like grammar that
# may, in some incarnation, form the basis for DocBook V.next. Or it may not.
# At the moment, it's just an exploration by Norm. It has utterly no normative
# value at all.
#
# Author: Norman Walsh, <ndw@nwalsh.com>
# Source: Derived from DocBook XML V4.3
# Release: $Id$
#

namespace rng  = "http://relaxng.org/ns/structure/1.0"
namespace s = "http://www.ascc.net/xml/schematron"
namespace db = "http://docbook.org/docbook-ng/absinthe"
default namespace = "http://docbook.org/docbook-ng/absinthe"

start |= db.setindex

ubiq.inlines |= db.indexterm
indexing.inlines |= db.indexterm
blocks.nopara |= db.indexterm
navigation.components |= db.index
setindex.components |= db.setindex

info.elements |= db.itermset

significance.attribute = attribute significance { "normal" | "preferred" }
zone.attribute = attribute zone { xsd:IDREFS }
pagenum.attribute = attribute pagenum { text }
scope.attribute = attribute scope { "all" | "global" | "local" }

sortas.attribute = attribute sortas { text }

# ======================================================================

[
   db:refname [ "itermset" ]
   db:refpurpose [ "" ]
]
div {

   local.itermset.attributes = empty

   itermset.role.attribute = attribute role { text }

   itermset.attr =
      itermset.role.attribute?
    & common.attributes
    & common.linking.attributes
    & local.itermset.attributes

   db.itermset =
      element itermset {
         itermset.attr,
         indexterm.singular+
      }
}

# ======================================================================

indexterm.contentmodel =
   db.primary?,
   ((db.secondary,
      ((db.tertiary, (db.see | db.seealso+)?)
       | db.see
       | db.seealso+)?)
    | db.see
    | db.seealso+)?

# ======================================================================

[
   db:refname [ "indexterm" ]
   db:refpurpose [ "" ]
]
div {

   local.indexterm.singular.attributes = empty

   indexterm.singular.role.attribute = attribute role { text }

   indexterm.singular.attr =
      indexterm.singular.role.attribute?
    & common.attributes
    & common.linking.attributes
    & significance.attribute?
    & zone.attribute?
    & pagenum.attribute?
    & scope.attribute?
    & attribute class { "singular" }?
    & local.indexterm.singular.attributes

   indexterm.singular =
      element indexterm {
         indexterm.singular.attr,
         indexterm.contentmodel
      }
}

# ======================================================================

[
   db:refname [ "indexterm" ]
   db:refpurpose [ "" ]
]
div {

   local.indexterm.startofrange.attributes = empty

   indexterm.startofrange.role.attribute = attribute role { text }

   indexterm.startofrange.attr =
      indexterm.startofrange.role.attribute?
    & common.attributes
    & common.linking.attributes
    & significance.attribute?
    & zone.attribute?
    & pagenum.attribute?
    & scope.attribute?
    & attribute class { "startofrange" }
    & local.indexterm.startofrange.attributes

   indexterm.startofrange =
      element indexterm {
         indexterm.startofrange.attr,
         indexterm.contentmodel
      }
}

# ======================================================================

[
   db:refname [ "indexterm" ]
   db:refpurpose [ "" ]
]
div {

   local.indexterm.endofrange.attributes = empty

   indexterm.endofrange.role.attribute = attribute role { text }

   indexterm.endofrange.attr =
      indexterm.endofrange.role.attribute?
    & common.attributes
    & common.linking.attributes
    & significance.attribute?
    & zone.attribute?
    & pagenum.attribute?
    & scope.attribute?
    & attribute class { "endofrange" }
    & attribute startref { xsd:IDREF }
    & local.indexterm.endofrange.attributes

   indexterm.endofrange =
      element indexterm {
         indexterm.endofrange.attr,
         indexterm.contentmodel
      }
}

# ======================================================================

[
   db:refname [ "indexterm" ]
   db:refpurpose [ "" ]
]
div {

   db.indexterm = (indexterm.singular|indexterm.startofrange|indexterm.endofrange)

}

# ======================================================================

[
   db:refname [ "primary" ]
   db:refpurpose [ "" ]
]
div {

   local.primary.attributes = empty

   primary.role.attribute = attribute role { text }

   primary.attr =
      primary.role.attribute?
    & common.attributes
    & common.linking.attributes
    & sortas.attribute?
    & local.primary.attributes

   db.primary =
      element primary {
         primary.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "secondary" ]
   db:refpurpose [ "" ]
]
div {

   local.secondary.attributes = empty

   secondary.role.attribute = attribute role { text }

   secondary.attr =
      secondary.role.attribute?
    & common.attributes
    & common.linking.attributes
    & sortas.attribute?
    & local.secondary.attributes

   db.secondary =
      element secondary {
         secondary.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "tertiary" ]
   db:refpurpose [ "" ]
]
div {

   local.tertiary.attributes = empty

   tertiary.role.attribute = attribute role { text }

   tertiary.attr =
      tertiary.role.attribute?
    & common.attributes
    & common.linking.attributes
    & sortas.attribute?
    & local.tertiary.attributes

   db.tertiary =
      element tertiary {
         tertiary.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "see" ]
   db:refpurpose [ "" ]
]
div {

   local.see.attributes = empty

   see.role.attribute = attribute role { text }

   see.attr =
      see.role.attribute?
    & common.attributes
    & common.linking.attributes
    & local.see.attributes

   db.see =
      element see {
         see.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "seealso" ]
   db:refpurpose [ "" ]
]
div {

   local.seealso.attributes = empty

   seealso.role.attribute = attribute role { text }

   seealso.attr =
      seealso.role.attribute?
    & common.attributes
    & common.linking.attributes
    & local.seealso.attributes

   db.seealso =
      element seealso {
         seealso.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "index" ]
   db:refpurpose [ "" ]
]
div {

   local.index.attributes = empty

   index.status.attribute = status.attribute

   index.role.attribute = attribute role { text }

   index.attr =
      index.role.attribute?
    & common.attributes
    & common.linking.attributes
    & label.attribute?
    & index.status.attribute?
    & local.index.attributes

   index.info = docbook.info

   db.index =
      element index {
         index.attr,
         index.info,
         blocks*,
         (db.indexdiv* | db.indexentry* | db.segmentedlist)
      }
}

#  ======================================================================

[
   db:refname [ "setindex" ]
   db:refpurpose [ "" ]
]
div {

   local.setindex.attributes = empty

   setindex.status.attribute = status.attribute

   setindex.role.attribute = attribute role { text }

   setindex.attr =
      setindex.role.attribute?
    & common.attributes
    & common.linking.attributes
    & label.attribute?
    & setindex.status.attribute?
    & local.setindex.attributes

   setindex.info = docbook.info

   db.setindex =
      element setindex {
         setindex.attr,
         setindex.info,
         blocks*,
         (db.indexdiv* | db.indexentry*)
      }
}

# ======================================================================

[
   db:refname [ "indexdiv" ]
   db:refpurpose [ "" ]
]
div {

   local.indexdiv.attributes = empty

   indexdiv.status.attribute = status.attribute

   indexdiv.role.attribute = attribute role { text }

   indexdiv.attr =
      indexdiv.role.attribute?
    & common.attributes
    & common.linking.attributes
    & label.attribute?
    & indexdiv.status.attribute?
    & local.indexdiv.attributes

   indexdiv.info = docbook.info.titlereq

   db.indexdiv =
      element indexdiv {
         indexdiv.attr,
         indexdiv.info,
         blocks*,
         (db.indexentry+|db.segmentedlist)
      }
}

# ======================================================================

[
   db:refname [ "indexentry" ]
   db:refpurpose [ "" ]
]
div {

   local.indexentry.attributes = empty

   indexentry.role.attribute = attribute role { text }

   indexentry.attr =
      indexentry.role.attribute?
    & common.attributes
    & common.linking.attributes
    & local.indexentry.attributes

   db.indexentry =
      element indexentry {
         indexentry.attr,
         db.primaryie,
         (db.seeie | db.seealsoie)*,
         (db.secondaryie, (db.seeie | db.seealsoie | db.tertiaryie)*)*
      }
}

# ======================================================================

[
   db:refname [ "primaryie" ]
   db:refpurpose [ "" ]
]
div {

   local.primaryie.attributes = empty

   primaryie.role.attribute = attribute role { text }

   primaryie.attr =
      primaryie.role.attribute?
    & common.attributes
    & linkends.attribute?
    & local.primaryie.attributes

   db.primaryie =
      element primaryie {
         primaryie.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "secondaryie" ]
   db:refpurpose [ "" ]
]
div {

   local.secondaryie.attributes = empty

   secondaryie.role.attribute = attribute role { text }

   secondaryie.attr =
      secondaryie.role.attribute?
    & common.attributes
    & linkends.attribute?
    & local.secondaryie.attributes

   db.secondaryie =
      element secondaryie {
         secondaryie.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "tertiaryie" ]
   db:refpurpose [ "" ]
]
div {

   local.tertiaryie.attributes = empty

   tertiaryie.role.attribute = attribute role { text }

   tertiaryie.attr =
      tertiaryie.role.attribute?
    & common.attributes
    & linkends.attribute?
    & local.tertiaryie.attributes

   db.tertiaryie =
      element tertiaryie {
         tertiaryie.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "seeie" ]
   db:refpurpose [ "" ]
]
div {

   local.seeie.attributes = empty

   seeie.role.attribute = attribute role { text }

   seeie.attr =
      seeie.role.attribute?
    & common.attributes
    & linkend.attribute?
    & local.seeie.attributes

   db.seeie =
      element seeie {
         seeie.attr,
         inlines*
      }
}

# ======================================================================

[
   db:refname [ "seealsoie" ]
   db:refpurpose [ "" ]
]
div {

   local.seealsoie.attributes = empty

   seealsoie.role.attribute = attribute role { text }

   seealsoie.attr =
      seealsoie.role.attribute?
    & common.attributes
    & linkends.attribute?
    & local.seealsoie.attributes

   db.seealsoie =
      element seealsoie {
         seealsoie.attr,
         inlines*
      }
}
